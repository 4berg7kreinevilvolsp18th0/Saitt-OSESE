# Self-hosted –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –û–°–° –î–í–§–£

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ self-hosted –ë–î:

1. **–ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ä–∞–∑–º–µ—Ä—É
2. **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–≤–æ–µ–º —Å–µ—Ä–≤–µ—Ä–µ
4. **–≠–∫–æ–Ω–æ–º–∏—è** ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä)
5. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** ‚Äî –Ω–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç –ª–∏–º–∏—Ç–æ–≤ Supabase

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

1. **–ù—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä** ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∏–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π
2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** ‚Äî –Ω—É–∂–Ω–æ —Å–∞–º–æ–º—É –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
3. **–ë—ç–∫–∞–ø—ã** ‚Äî –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –Ω—É–∂–Ω–æ —Å–∞–º–æ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å

---

## üñ•Ô∏è –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–µ—Ä–≤–µ—Ä –î–í–§–£ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ï—Å–ª–∏ –î–í–§–£ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:**

**–ü–ª—é—Å—ã:**
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –û–°–°
- –ù–∞–¥–µ–∂–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ IT-–æ—Ç–¥–µ–ª–∞
- –í–æ–∑–º–æ–∂–Ω–æ, —É–∂–µ –µ—Å—Ç—å PostgreSQL

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ IT-–æ—Ç–¥–µ–ª –î–í–§–£
- –í—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞
- –î–æ—Å—Ç—É–ø –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–®–∞–≥–∏:**
1. –ù–∞–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å –≤ IT-–æ—Ç–¥–µ–ª –î–í–§–£
2. –£–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (PostgreSQL, –º–∏–Ω–∏–º—É–º 2 GB RAM, 50 GB –¥–∏—Å–∫–∞)
3. –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 2: VPS (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)

**–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**

#### Oracle Cloud Free Tier
- 2 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω—ã (ARM)
- 4 GB RAM, 200 GB –¥–∏—Å–∫–∞
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è PostgreSQL

#### Google Cloud Free Tier
- $300 –∫—Ä–µ–¥–∏—Ç–æ–≤ –Ω–∞ 3 –º–µ—Å—è—Ü–∞
- –ü–æ—Ç–æ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Always Free (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)

#### AWS Free Tier
- 750 —á–∞—Å–æ–≤ EC2 –≤ –º–µ—Å—è—Ü (12 –º–µ—Å—è—Ü–µ–≤)
- –ü–æ—Ç–æ–º –ø–ª–∞—Ç–Ω–æ

**–ü–ª–∞—Ç–Ω—ã–µ (–¥–µ—à–µ–≤—ã–µ):**
- **DigitalOcean:** $6/–º–µ—Å—è—Ü (1 GB RAM, 25 GB SSD)
- **Hetzner:** ‚Ç¨4.15/–º–µ—Å—è—Ü (2 GB RAM, 20 GB SSD)
- **Vultr:** $6/–º–µ—Å—è—Ü (1 GB RAM, 25 GB SSD)

### –í–∞—Ä–∏–∞–Ω—Ç 3: Railway / Render (managed PostgreSQL)

**Railway:**
- $5 –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ –º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- Managed PostgreSQL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**Render:**
- Free tier (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)
- Managed PostgreSQL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

**–î–ª—è 3,000-10,000 –æ–±—Ä–∞—â–µ–Ω–∏–π/–≥–æ–¥:**
- **CPU:** 1-2 —è–¥—Ä–∞
- **RAM:** 2 GB (–º–∏–Ω–∏–º—É–º), 4 GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–î–∏—Å–∫:** 20 GB (–º–∏–Ω–∏–º—É–º), 50 GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–û–°:** Ubuntu 22.04 LTS –∏–ª–∏ Debian 12

**–î–ª—è 10,000-20,000 –æ–±—Ä–∞—â–µ–Ω–∏–π/–≥–æ–¥:**
- **CPU:** 2-4 —è–¥—Ä–∞
- **RAM:** 4-8 GB
- **–î–∏—Å–∫:** 100 GB
- **–û–°:** Ubuntu 22.04 LTS –∏–ª–∏ Debian 12

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ:

- PostgreSQL 14+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 15+)
- Node.js 18+ (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Nginx (–¥–ª—è reverse proxy, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt, –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

**–ù–∞ Ubuntu/Debian:**

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
psql --version

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres
sudo -u postgres psql

# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE oss_dvfu;

# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE USER oss_user WITH PASSWORD 'strong_password_here';

# –î–∞—Ç—å –ø—Ä–∞–≤–∞
GRANT ALL PRIVILEGES ON DATABASE oss_dvfu TO oss_user;

# –í—ã–π—Ç–∏
\q
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `postgresql.conf`:**
```bash
sudo nano /etc/postgresql/15/main/postgresql.conf
```

**–ù–∞–π—Ç–∏ –∏ –∏–∑–º–µ–Ω–∏—Ç—å:**
```
listen_addresses = '*'  # –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π IP
port = 5432
max_connections = 100
shared_buffers = 256MB  # –¥–ª—è 2 GB RAM
effective_cache_size = 1GB
```

**–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `pg_hba.conf`:**
```bash
sudo nano /etc/postgresql/15/main/pg_hba.conf
```

**–î–æ–±–∞–≤–∏—Ç—å (–¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞):**
```
# –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ Vercel/–≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
host    oss_dvfu    oss_user    0.0.0.0/0    md5
```

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL:**
```bash
sudo systemctl restart postgresql
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å PostgreSQL –ø–æ—Ä—Ç
sudo ufw allow 5432/tcp

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ IP (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)
sudo ufw allow from YOUR_IP to any port 5432
```

### –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
psql -U oss_user -d oss_dvfu -h localhost

# –ò–ª–∏ –∏–∑ —Ñ–∞–π–ª–∞
psql -U oss_user -d oss_dvfu -h localhost -f database/schema.sql
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å Supabase

### –®–∞–≥ 1: –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase

**–ß–µ—Ä–µ–∑ Supabase Dashboard:**
1. –ó–∞–π—Ç–∏ –≤ SQL Editor
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∞–º–ø:

```sql
-- –≠–∫—Å–ø–æ—Ä—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π
COPY appeals TO '/tmp/appeals.csv' WITH CSV HEADER;

-- –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
COPY directions TO '/tmp/directions.csv' WITH CSV HEADER;

-- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ pg_dump:**
```bash
# –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ Supabase —á–µ—Ä–µ–∑ psql
pg_dump -h db.xxxxx.supabase.co -U postgres -d postgres > backup.sql
```

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç –≤ –Ω–æ–≤—É—é –ë–î

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
psql -U oss_user -d oss_dvfu -f database/schema.sql

# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
psql -U oss_user -d oss_dvfu -f backup.sql
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í Vercel:**
```
DATABASE_URL=postgresql://oss_user:password@your-server-ip:5432/oss_dvfu
NEXT_PUBLIC_SUPABASE_URL=  # –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å
NEXT_PUBLIC_SUPABASE_ANON_KEY=  # –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å
```

**–î–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase Auth –æ—Ç–¥–µ–ª—å–Ω–æ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- –ò–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ NextAuth.js / Auth.js
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–∑ Supabase Auth

### –í–∞—Ä–∏–∞–Ω—Ç 1: NextAuth.js (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install next-auth @auth/prisma-adapter
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```typescript
// app/api/auth/[...nextauth]/route.ts
import NextAuth from 'next-auth'
import CredentialsProvider from 'next-auth/providers/credentials'
import { compare } from 'bcryptjs'

export const authOptions = {
  providers: [
    CredentialsProvider({
      name: 'Credentials',
      credentials: {
        email: { label: "Email", type: "email" },
        password: { label: "Password", type: "password" }
      },
      async authorize(credentials) {
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –≤–∞—à–µ–π –ë–î
        const user = await checkUserInDB(credentials.email, credentials.password)
        if (user) return user
        return null
      }
    })
  ],
  // ...
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ—Å—Ç–∞—è JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  role TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**API –¥–ª—è –≤—Ö–æ–¥–∞:**
```typescript
// app/api/auth/login/route.ts
import { compare } from 'bcryptjs'
import { sign } from 'jsonwebtoken'

export async function POST(request: Request) {
  const { email, password } = await request.json()
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î
  const user = await db.query('SELECT * FROM users WHERE email = $1', [email])
  
  if (user && await compare(password, user.password_hash)) {
    const token = sign({ userId: user.id, role: user.role }, SECRET)
    return Response.json({ token })
  }
  
  return Response.json({ error: 'Invalid credentials' }, { status: 401 })
}
```

---

## üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ó–∞–º–µ–Ω–∏—Ç—å Supabase Client –Ω–∞ –ø—Ä—è–º–æ–π PostgreSQL

**–ë—ã–ª–æ (Supabase):**
```typescript
import { createClient } from '@supabase/supabase-js'
const supabase = createClient(url, key)
const { data } = await supabase.from('appeals').select('*')
```

**–°—Ç–∞–ª–æ (–ø—Ä—è–º–æ–π PostgreSQL):**
```typescript
import { Pool } from 'pg'
const pool = new Pool({ connectionString: process.env.DATABASE_URL })
const { rows } = await pool.query('SELECT * FROM appeals')
```

### 2. –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

**`lib/db.ts`:**
```typescript
import { Pool } from 'pg'

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
})

export async function query(text: string, params?: any[]) {
  const start = Date.now()
  const res = await pool.query(text, params)
  const duration = Date.now() - start
  console.log('Executed query', { text, duration, rows: res.rowCount })
  return res
}

export default pool
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–∏–º–µ—Ä:**
```typescript
// –ë—ã–ª–æ
const { data, error } = await supabase
  .from('appeals')
  .select('*')
  .eq('status', 'new')

// –°—Ç–∞–ª–æ
const { rows } = await query(
  'SELECT * FROM appeals WHERE status = $1',
  ['new']
)
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. SSL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**–í production –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSL:**
```typescript
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: {
    rejectUnauthorized: true,
    ca: fs.readFileSync('path/to/ca-cert.pem').toString()
  }
})
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

**–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∞–π—Ä–≤–æ–ª:**
- –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å IP Vercel
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH —Ç—É–Ω–Ω–µ–ª—å

**–°–ø–∏—Å–æ–∫ IP Vercel:**
```
76.76.21.21
76.223.126.42
# –ò –¥—Ä—É–≥–∏–µ (—Å–º. Vercel docs)
```

### 3. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã:**
```bash
#!/bin/bash
# backup.sh
DATE=$(date +%Y%m%d_%H%M%S)
pg_dump -U oss_user -d oss_dvfu > /backups/oss_dvfu_$DATE.sql

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
find /backups -name "*.sql" -mtime +30 -delete
```

**–ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron:**
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø –≤ 2:00
0 2 * * * /path/to/backup.sh
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
# –í postgresql.conf
log_statement = 'all'  # –∏–ª–∏ 'mod' –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
log_duration = on
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```sql
-- –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
SELECT pg_size_pretty(pg_database_size('oss_dvfu'));

-- –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
SELECT 
  schemaname,
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**VACUUM –∏ ANALYZE:**
```sql
-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ postgresql.conf)
autovacuum = on
autovacuum_naptime = 1min

-- –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
VACUUM ANALYZE;
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pg_stat_statements:**
```sql
CREATE EXTENSION pg_stat_statements;

-- –¢–æ–ø –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT 
  query,
  calls,
  total_time,
  mean_time,
  rows
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
```

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

### Self-hosted (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä –î–í–§–£):
- **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** ‚úÖ
- –ù—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### VPS (–µ—Å–ª–∏ –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –î–í–§–£):
- **Oracle Cloud Free Tier:** –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞
- **DigitalOcean/Hetzner:** $4-6/–º–µ—Å—è—Ü
- **Railway:** $5 –∫—Ä–µ–¥–∏—Ç–æ–≤/–º–µ—Å—è—Ü (–ø–æ—á—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Supabase:
- **Supabase Free:** 500 MB –ë–î, 1 GB Storage
- **Supabase Pro:** $25/–º–µ—Å—è—Ü (8 GB –ë–î, 100 GB Storage)
- **Self-hosted:** –ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ (–≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –û–°–°

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:

1. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —É –î–í–§–£**
   - –ù–∞–ø–∏—Å–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   - –£–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
   - –û–±—ä—è—Å–Ω–∏—Ç—å –ø–æ–ª—å–∑—É –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

2. **–ï—Å–ª–∏ –î–í–§–£ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Oracle Cloud Free Tier
   - –ò–ª–∏ –Ω–∞—á–∞—Ç—å —Å Supabase, –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:

1. **Self-hosted –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –î–í–§–£**
   - –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
   - –ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ

2. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã
   - –•—Ä–∞–Ω–∏—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [ ] –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–î–í–§–£ –∏–ª–∏ VPS)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –ë–î

### –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–æ–≤—É—é –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞:
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å Supabase Client –Ω–∞ –ø—Ä—è–º–æ–π PostgreSQL
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (NextAuth –∏–ª–∏ JWT)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Production:
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∞–π—Ä–≤–æ–ª
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [NextAuth.js Documentation](https://next-auth.js.org/)
- [Oracle Cloud Free Tier](https://www.oracle.com/cloud/free/)
- [pg (Node.js PostgreSQL client)](https://node-postgres.com/)

---

**–ò—Ç–æ–≥:** Self-hosted –ë–î ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –û–°–°, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É. –≠—Ç–æ –¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –±–µ–∑–ª–∏–º–∏—Ç–Ω—É—é –ë–î –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

