# Поиск по обращениям

## Обзор

Система поиска позволяет быстро находить обращения по различным критериям.

## Где доступен поиск

### Админ-панель

В `/admin/appeals`:
- Поисковая строка вверху страницы
- Поиск в реальном времени
- Фильтрация по заголовку, описанию, контакту

### API

Endpoint для программного поиска:
```
GET /api/appeals/search?q=запрос&limit=20
```

## Как работает поиск

### Клиентский поиск (админ-панель)

1. Пользователь вводит запрос
2. Поиск выполняется локально по загруженным обращениям
3. Результаты фильтруются в реальном времени
4. Поиск по: заголовку, описанию, контакту

### Серверный поиск (API)

1. Запрос отправляется на сервер
2. Поиск в базе данных через Supabase
3. Использует `ilike` для case-insensitive поиска
4. Возвращает JSON с результатами

## Использование API

### Базовый поиск

```bash
GET /api/appeals/search?q=отопление
```

### С лимитом

```bash
GET /api/appeals/search?q=стипендия&limit=50
```

### Ответ

```json
{
  "results": [
    {
      "id": "...",
      "title": "Проблема с отоплением",
      "description": "...",
      "status": "in_progress",
      "created_at": "2024-01-15T10:00:00Z"
    }
  ],
  "count": 1,
  "query": "отопление"
}
```

## Улучшения поиска

### Полнотекстовый поиск PostgreSQL

Для более мощного поиска можно использовать PostgreSQL full-text search:

```sql
-- Добавить полнотекстовый индекс
CREATE INDEX idx_appeals_search ON appeals 
USING gin(to_tsvector('russian', title || ' ' || description));

-- Поиск
SELECT * FROM appeals
WHERE to_tsvector('russian', title || ' ' || description) 
  @@ to_tsquery('russian', 'отопление & проблема');
```

### Поиск по тегам

```typescript
// Поиск по тегам
const { data } = await supabase
  .from('appeals')
  .select('*')
  .contains('tags', ['общага', 'ремонт']);
```

### Поиск по датам

```typescript
// Поиск за последние 7 дней
const { data } = await supabase
  .from('appeals')
  .select('*')
  .gte('created_at', new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString());
```

## Компонент SearchBar

Используется в админ-панели. Можно использовать в других местах:

```tsx
import SearchBar from '../components/SearchBar';

<SearchBar
  onSearch={(query) => {
    // Ваша логика поиска
    console.log('Поиск:', query);
  }}
  placeholder="Поиск..."
/>
```

## Советы по использованию

1. **Минимум 2 символа** - для производительности
2. **Debounce** - уже реализован (300ms)
3. **Индексы** - убедитесь, что индексы созданы в БД
4. **Ограничение результатов** - используйте limit для больших наборов данных

## Расширение поиска

Можно добавить:
- Поиск по статусу
- Поиск по приоритету
- Поиск по направлению
- Поиск по назначенному
- Поиск по датам
- Комбинированные фильтры

