# Регистрация администраторов и модераторов

Система регистрации позволяет новым членам ОСС и администраторам создать аккаунт для работы с обращениями.

## Процесс регистрации

1. Перейдите на `/admin/register`
2. Заполните форму:
   - **ФИО**: Ваше полное имя
   - **Email**: Email адрес для входа и уведомлений
   - **Пароль**: Минимум 8 символов
   - **Подтверждение пароля**: Повторите пароль
   - **Роль**: Выберите вашу роль в ОСС
3. Нажмите "Зарегистрироваться"

## Роли

- **Член ОСС**: Базовый доступ к обращениям своего направления
- **Руководитель направления**: Полный доступ к обращениям своего направления
- **Руководство ОСС**: Полный доступ ко всем обращениям
- **Аппарат**: Технический персонал с расширенными правами

## После регистрации

После регистрации:
1. Создаётся аккаунт в Supabase Auth
2. Создаётся запись в таблице `user_roles` (требует подтверждения администратора)
3. Создаются настройки уведомлений по умолчанию
4. Вы можете войти в систему через `/admin/login`

## Подтверждение роли

После регистрации роль должна быть подтверждена администратором:
1. Администратор заходит в Supabase Dashboard
2. Переходит в таблицу `user_roles`
3. Находит запись нового пользователя
4. Подтверждает или изменяет роль при необходимости

Альтернативно, роль может быть назначена через SQL:

```sql
-- Назначить роль пользователю
INSERT INTO user_roles (user_id, role, direction_id)
VALUES ('user-uuid-here', 'member', 'direction-uuid-here');

-- Или обновить существующую роль
UPDATE user_roles
SET role = 'lead', direction_id = 'direction-uuid-here'
WHERE user_id = 'user-uuid-here';
```

## Безопасность

- Пароли хранятся в зашифрованном виде в Supabase Auth
- Доступ к админ-панели контролируется через RLS политики
- Роли проверяются при каждом запросе к базе данных

## Troubleshooting

### Ошибка "Email already exists"

Email уже зарегистрирован. Используйте функцию восстановления пароля или обратитесь к администратору.

### Не могу войти после регистрации

Убедитесь, что:
1. Роль была подтверждена администратором
2. Вы используете правильный email и пароль
3. Email был подтверждён (если требуется email verification в Supabase)

### Роль не работает

Проверьте в Supabase Dashboard:
1. Таблица `user_roles` содержит вашу запись
2. Роль указана правильно
3. `direction_id` указан корректно (если требуется)

